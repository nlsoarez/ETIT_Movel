<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta SLA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        input, button {
            padding: 10px;
            font-size: 16px;
            margin: 10px 0;
        }
        .resultados {
            margin-top: 20px;
        }
        .resultado-item {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Consulta de SLA - Tempo de Perda</h1>

    <label for="loginInput">Digite o Login:</label>
    <input type="text" id="loginInput" placeholder="Ex: n5577565">
    <button onclick="consultarSLA()">Consultar</button>

    <div class="resultados" id="resultados"></div>

    <script>
        function consultarSLA() {
            var login = document.getElementById('loginInput').value.toLowerCase(); // Obtendo o login
            console.log("Consultando para:", login);

            var planilha = carregarPlanilha(); // Simulação de carregamento de planilha
            console.log("Planilha carregada:", planilha);

            var resultados = [];
            var totalTempo = 0;  // Para calcular a média
            var totalPerdas = 0; // Para contar o número total de perdas

            planilha.forEach(function(linha, index) {
                var loginCelula = linha[1].toLowerCase(); // Verificar o login na linha
                var tempo = linha[6]; // Tempo está na coluna F para HFC, G para GPON

                // Verifica se o login corresponde e se o tempo é válido
                if (loginCelula === login) {
                    // Verifica se o tempo é válido e é uma string
                    if (typeof tempo === 'string' || tempo instanceof String) {
                        var tempoSplit = tempo.split(':'); // Separar tempo no formato hh:mm:ss

                        // Verifica se o tempo está no formato correto
                        if (tempoSplit.length === 3) {
                            // Converter tempo para minutos
                            var horas = parseInt(tempoSplit[0], 10);
                            var minutos = parseInt(tempoSplit[1], 10);
                            var segundos = parseInt(tempoSplit[2], 10);

                            var tempoEmMinutos = horas * 60 + minutos + (segundos / 60);
                            totalTempo += tempoEmMinutos; // Somar ao total de tempo
                            totalPerdas++;

                            resultados.push({
                                outage: linha[0],  // Coluna A para Outage
                                login: linha[1],    // Coluna B para Login
                                tempo: tempo,       // Tempo original
                                tempoEmMinutos: tempoEmMinutos.toFixed(2) // Tempo em minutos
                            });
                        } else {
                            console.log("Tempo inválido na linha " + (index + 1) + ": " + tempo);
                        }
                    } else {
                        console.log("Tempo não encontrado ou não é uma string na linha " + (index + 1) + ": ", linha);
                    }
                }
            });

            // Exibe os resultados na tela
            var resultadosDiv = document.getElementById('resultados');
            resultadosDiv.innerHTML = ''; // Limpar resultados anteriores

            if (resultados.length > 0) {
                resultados.forEach(function(resultado) {
                    var resultadoDiv = document.createElement('div');
                    resultadoDiv.classList.add('resultado-item');
                    resultadoDiv.innerHTML = "Outage: " + resultado.outage + " | Tempo: " + resultado.tempoEmMinutos + " minutos";
                    resultadosDiv.appendChild(resultadoDiv);
                });

                // Calcular a média
                var mediaTempo = totalTempo / totalPerdas;
                var mediaDiv = document.createElement('div');
                mediaDiv.classList.add('resultado-item');
                mediaDiv.innerHTML = "<strong>Média do tempo de perdas: " + mediaTempo.toFixed(2) + " minutos</strong>";
                resultadosDiv.appendChild(mediaDiv);

            } else {
                var noResultsDiv = document.createElement('div');
                noResultsDiv.classList.add('resultado-item');
                noResultsDiv.innerHTML = "<strong>Nenhum resultado encontrado para o login " + login + ".</strong>";
                resultadosDiv.appendChild(noResultsDiv);
            }
        }

        // Função simulada de carregamento da planilha (a função real deve carregar os dados reais)
        function carregarPlanilha() {
            // Exemplo de dados de planilha
            return [
                ["Outage1", "n5577565", "12/03/2025", "Outros dados", "F", "G", "00:15:30"],
                ["Outage2", "n5577565", "12/03/2025", "Outros dados", "F", "G", "01:30:45"],
                ["Outage3", "n5577565", "12/03/2025", "Outros dados", "F", "G", "00:45:10"],
                ["Outage4", "n5577565", "12/03/2025", "Outros dados", "F", "G", "00:20:00"]
            ];
        }
    </script>
</body>
</html>
