import pandas as pd
import datetime

def processar_arquivo(file_path, login_filtro):
    # Carregar a planilha
    df = pd.read_excel(file_path)
    
    # Garantir que as colunas necessárias existam
    colunas_necessarias = ['Login', 'ID Outage', 'Tipo', 'Início', 'Fim']
    if not all(col in df.columns for col in colunas_necessarias):
        return "Erro: Colunas necessárias não encontradas no arquivo."
    
    # Filtrar pelo login
    df_filtrado = df[df['Login'] == login_filtro].copy()
    
    # Converter colunas de tempo
    df_filtrado['Início'] = pd.to_datetime(df_filtrado['Início'], format='%H:%M:%S', errors='coerce')
    df_filtrado['Fim'] = pd.to_datetime(df_filtrado['Fim'], format='%H:%M:%S', errors='coerce')
    
    # Calcular tempo em minutos
    df_filtrado['Tempo (min)'] = (df_filtrado['Fim'] - df_filtrado['Início']).dt.total_seconds() / 60
    
    # Substituir valores inválidos por 0
    df_filtrado['Tempo (min)'] = df_filtrado['Tempo (min)'].fillna(0).round(2)
    
    # Contar ganhos e perdas
    ganhos = len(df_filtrado[df_filtrado['Tipo'] == 'Ganho'])
    perdas = len(df_filtrado[df_filtrado['Tipo'] == 'Perda'])
    
    # Calcular tempo médio
    tempo_medio = df_filtrado['Tempo (min)'].mean()
    tempo_medio = round(tempo_medio, 2) if not pd.isna(tempo_medio) else 0
    
    return df_filtrado[['ID Outage', 'Tipo', 'Tempo (min)']], ganhos, perdas, tempo_medio

# Exemplo de uso
file_path = '/mnt/data/Teste.xlsx'  # Caminho do arquivo
login_filtro = 'N5923996'  # Exemplo de login

df_resultado, ganhos, perdas, tempo_medio = processar_arquivo(file_path, login_filtro)
print(df_resultado)
print(f"Ganhos: {ganhos} | Perdas: {perdas}")
print(f"Tempo Médio: {tempo_medio} min")
